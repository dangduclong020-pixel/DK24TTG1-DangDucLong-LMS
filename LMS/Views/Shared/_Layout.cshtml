<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"] - LMS Online System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    @await RenderSectionAsync("Styles", required: false)

    <style>
        /* --- CSS VARIABLES & RESET --- */
        :root {
            --primary-color: #4361ee; /* Màu xanh hiện đại hơn */
            --primary-light: #eef2ff;
            --sidebar-bg: #ffffff;
            --text-main: #334155;
            --text-muted: #94a3b8;
            --border-color: #e2e8f0;
            --sidebar-width: 280px;
            --sidebar-width-collapsed: 80px;
            --transition-speed: 0.3s;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: #f1f5f9; min-height: 100vh; }

        /* --- SIDEBAR CONTAINER --- */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0; left: 0;
            transition: width var(--transition-speed) ease;
            z-index: 1000;
            box-shadow: 4px 0 24px rgba(0,0,0,0.02);
        }

        /* --- LOGO AREA --- */
        .sidebar-header {
            height: 80px;
            display: flex;
            align-items: center;
            padding: 0 24px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 22px;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
            overflow: hidden;
            white-space: nowrap;
        }
        
        .logo i { font-size: 28px; }
        .logo span { color: #1e293b; }

        /* --- MENU SCROLL AREA --- */
        .sidebar-menu {
            flex: 1;
            padding: 20px 16px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        /* Custom Scrollbar */
        .sidebar-menu::-webkit-scrollbar { width: 5px; }
        .sidebar-menu::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 4px; }

        /* Menu Groups */
        .menu-group-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            margin: 20px 0 10px 12px;
            font-weight: 600;
            white-space: nowrap;
            opacity: 1;
            transition: opacity 0.2s;
        }

        /* Menu Items */
        .menu-item {
            position: relative;
            margin-bottom: 4px;
        }

        .menu-link {
            display: flex;
            align-items: center;
            padding: 12px;
            color: var(--text-main);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s ease;
            cursor: pointer;
            justify-content: space-between; /* Để đẩy mũi tên sang phải */
        }

        .menu-link-content {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .menu-link i.icon {
            font-size: 22px;
            color: var(--text-muted);
            min-width: 22px;
            transition: color 0.2s;
        }

        .menu-link span {
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
        }

        .arrow {
            font-size: 16px;
            color: var(--text-muted);
            transition: transform 0.3s;
        }

        /* Hover & Active States */
        .menu-link:hover {
            background-color: #f8fafc;
            color: var(--primary-color);
        }
        .menu-link:hover i.icon { color: var(--primary-color); }

        .menu-item.active .menu-link {
            background-color: var(--primary-light);
            color: var(--primary-color);
        }
        .menu-item.active i.icon { color: var(--primary-color); }

        /* --- SUBMENU (Dropdown) --- */
        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
            padding-left: 48px; /* Indent sub items */
        }

        .submenu a {
            display: block;
            padding: 10px 0;
            font-size: 13px;
            color: #64748b;
            text-decoration: none;
            transition: 0.2s;
            position: relative;
        }

        .submenu a:hover { color: var(--primary-color); }
        .submenu a::before {
            content: "";
            position: absolute;
            left: -15px; top: 50%;
            width: 6px; height: 6px;
            background: #cbd5e1;
            border-radius: 50%;
            transform: translateY(-50%);
            transition: 0.2s;
        }
        .submenu a:hover::before { background: var(--primary-color); }

        /* Logic mở submenu */
        .menu-item.open .submenu { max-height: 200px; /* Đủ lớn để hiện hết items */ }
        .menu-item.open .arrow { transform: rotate(180deg); }

        /* --- SIDEBAR FOOTER (User Profile) --- */
        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
            background: #fff;
        }

        .user-avatar {
            width: 40px; height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-info {
            flex: 1;
            overflow: hidden;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-main);
            white-space: nowrap;
            overflow: hidden; text-overflow: ellipsis;
        }

        .user-role {
            font-size: 12px;
            color: var(--text-muted);
        }

        .logout-btn {
            color: var(--text-muted);
            cursor: pointer;
            transition: 0.2s;
        }
        .logout-btn:hover { color: #ef4444; } /* Màu đỏ khi hover logout */

        /* --- COLLAPSED STATE (Optional feature) --- */
        /* Nếu bạn muốn sidebar thu nhỏ, thêm class 'collapsed' vào thẻ .sidebar */
        .sidebar.collapsed { width: var(--sidebar-width-collapsed); }
        .sidebar.collapsed .logo span, 
        .sidebar.collapsed .menu-link span, 
        .sidebar.collapsed .arrow,
        .sidebar.collapsed .menu-group-label,
        .sidebar.collapsed .user-info,
        .sidebar.collapsed .submenu { 
            display: none; 
        }
        .sidebar.collapsed .sidebar-header { justify-content: center; padding: 0; }
        .sidebar.collapsed .menu-link { justify-content: center; }
        .sidebar.collapsed .menu-link-content { gap: 0; }
        .sidebar.collapsed .sidebar-footer { justify-content: center; }

        /* --- MAIN CONTENT AREA --- */
        .main-content {
            margin-left: var(--sidebar-width);
            padding: 20px 30px;
            min-height: 100vh;
            background: #f8fafc;
            width: calc(100% - var(--sidebar-width));
            transition: all var(--transition-speed) ease;
            position: relative;
        }

        /* Content wrapper để tối ưu không gian */
        .content-wrapper {
            max-width: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        /* Cards và containers */
        .card, .container-fluid {
            width: 100% !important;
            max-width: 100% !important;
        }

        /* Responsive design */
        @@media (max-width: 1200px) {
            .main-content {
                padding: 15px 20px;
            }
        }

        @@media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.show {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 15px;
            }
        }

    </style>
</head>
<body>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a asp-controller="Admin" asp-action="Index" class="logo">
                <i class='bx bxs-graduation'></i>
                <span>LMS Admin</span>
            </a>
        </div>

        <div class="sidebar-menu">
            
            <div class="menu-group-label">Tổng quan hệ thống</div>
            
            <div class="menu-item active">
                <a asp-controller="Admin" asp-action="Index" class="menu-link">
                    <div class="menu-link-content">
                        <i class='bx bx-grid-alt icon'></i>
                        <span>Dashboard</span>
                    </div>
                </a>
            </div>

            <div class="menu-item">
                <a asp-controller="Admin" asp-action="SystemReports" class="menu-link">
                    <div class="menu-link-content">
                        <i class='bx bx-analyse icon'></i>
                        <span>Báo cáo thống kê</span>
                    </div>
                </a>
            </div>

            <div class="menu-group-label">Quản lý người dùng</div>

            <div class="menu-item has-submenu">
                <div class="menu-link" onclick="toggleMenu(this)">
                    <div class="menu-link-content">
                        <i class='bx bx-user-check icon'></i>
                        <span>Quản lý người dùng</span>
                    </div>
                    <i class='bx bx-chevron-down arrow'></i>
                </div>
                <div class="submenu">
                    <a asp-controller="Admin" asp-action="UserManagement">Danh sách người dùng</a>
                    <a asp-controller="Admin" asp-action="Students">Quản lý sinh viên</a>
                    <a asp-controller="Admin" asp-action="CreateUser">Tạo tài khoản mới</a>
                    <a asp-controller="Admin" asp-action="ImportLecturers">Import giảng viên</a>
                    <a asp-controller="Admin" asp-action="ResetPassword">Reset mật khẩu</a>
                </div>
            </div>

            <div class="menu-group-label">Quản lý đào tạo</div>

            <div class="menu-item has-submenu">
                <div class="menu-link" onclick="toggleMenu(this)">
                    <div class="menu-link-content">
                        <i class='bx bx-buildings icon'></i>
                        <span>Khoa - Bộ môn</span>
                    </div>
                    <i class='bx bx-chevron-down arrow'></i>
                </div>
                <div class="submenu">
                    <a asp-controller="Admin" asp-action="FacultyManagement">Danh sách Khoa</a>
                    <a asp-controller="Admin" asp-action="CreateFaculty">Tạo Khoa mới</a>
                    <a asp-controller="Admin" asp-action="CreateDepartment">Tạo Bộ môn</a>
                    <a asp-controller="FacultyAdmin" asp-action="Index">Quản trị Khoa</a>
                </div>
            </div>

            <div class="menu-item has-submenu">
                <div class="menu-link" onclick="toggleMenu(this)">
                    <div class="menu-link-content">
                        <i class='bx bx-book-open icon'></i>
                        <span>Khóa học hệ thống</span>
                    </div>
                    <i class='bx bx-chevron-down arrow'></i>
                </div>
                <div class="submenu">
                    <a asp-controller="Admin" asp-action="AllCoursesOverview">Tất cả khóa học</a>
                    <a asp-controller="Admin" asp-action="SystemStatistics">Thống kê hệ thống</a>
                    <a asp-controller="Admin" asp-action="CourseStructureStandards">Chuẩn khóa học</a>
                </div>
            </div>

            <div class="menu-group-label">Khảo thí & Đánh giá</div>

            <div class="menu-item has-submenu">
                <div class="menu-link" onclick="toggleMenu(this)">
                    <div class="menu-link-content">
                        <i class='bx bx-clipboard icon'></i>
                        <span>Khảo thí</span>
                    </div>
                    <i class='bx bx-chevron-down arrow'></i>
                </div>
                <div class="submenu">
                    <a asp-controller="Admin" asp-action="ExamManagement">Quản lý đề thi</a>
                    <a asp-controller="Admin" asp-action="CreateExam">Tạo đề thi</a>
                    <a asp-controller="Admin" asp-action="QuestionBank">Ngân hàng câu hỏi</a>
                    <a asp-controller="Admin" asp-action="ExamResults">Kết quả thi</a>
                </div>
            </div>

            <div class="menu-group-label">Hệ thống</div>
            
            <div class="menu-item has-submenu">
                <div class="menu-link" onclick="toggleMenu(this)">
                    <div class="menu-link-content">
                        <i class='bx bx-cog icon'></i>
                        <span>Cài đặt hệ thống</span>
                    </div>
                    <i class='bx bx-chevron-down arrow'></i>
                </div>
                <div class="submenu">
                    <a asp-controller="Admin" asp-action="SystemSettings">Cấu hình chung</a>
                    <a asp-controller="Admin" asp-action="BackupRestore">Sao lưu & phục hồi</a>
                    <a asp-controller="Admin" asp-action="SystemLogs">Nhật ký hệ thống</a>
                    <a asp-controller="Admin" asp-action="SecuritySettings">Bảo mật hệ thống</a>
                </div>
            </div>

        </div>

        <div class="sidebar-footer">
            <img src="https://ui-avatars.com/api/?name=Admin+User&background=4361ee&color=fff" alt="User" class="user-avatar">
            <div class="user-info">
                <div class="user-name">Nguyễn Văn Admin</div>
                <div class="user-role">Super Admin</div>
            </div>
            <i class='bx bx-log-out logout-btn' title="Đăng xuất" onclick="logout()"></i>
        </div>
    </aside>

    <!-- Main Content Area -->
    <div class="main-content">
        <div class="content-wrapper">
            @RenderBody()
        </div>
    </div>

    <footer class="border-top footer text-muted" style="margin-left: var(--sidebar-width); padding: 20px; background: white; border-top: 1px solid #e2e8f0; margin-top: auto;">
        <div class="container-fluid">
            &copy; 2025 - LMS Online System - <a asp-area="" asp-controller="Home" asp-action="Privacy">Privacy Policy</a>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)

    <script>
        // Script để xử lý sidebar menu
        function toggleMenu(element) {
            const parent = element.parentElement;
            parent.classList.toggle('open');
            
            // Optional: Đóng menu khác (accordion effect)
            // const allItems = document.querySelectorAll('.menu-item');
            // allItems.forEach(item => {
            //     if (item !== parent) item.classList.remove('open');
            // });
        }

        // Highlight active menu dựa trên URL hiện tại
        document.addEventListener('DOMContentLoaded', function() {
            const currentPath = window.location.pathname;
            const menuLinks = document.querySelectorAll('.menu-link, .submenu a');
            
            menuLinks.forEach(link => {
                const href = link.getAttribute('href');
                if (href && currentPath.includes(href) && href !== '#') {
                    // Đánh dấu menu active
                    const menuItem = link.closest('.menu-item');
                    if (menuItem) {
                        menuItem.classList.add('active');
                        
                        // Nếu là submenu, mở parent
                        if (link.closest('.submenu')) {
                            menuItem.classList.add('open');
                        }
                    }
                }
            });
        });

        // Logout function
        function logout() {
            if (confirm('Bạn có chắc muốn đăng xuất?')) {
                // Gọi action Logout để xử lý đăng xuất
                window.location.href = '/Home/Logout';
            }
        }
    </script>
</body>
</html>